@Library('a42-jenkins-general-library') _

pipeline {
    environment {
        DOCKER_AGENT_PYTHON_IMAGE="python:3.8-slim-buster"
    }

    agent  any

    stages {
        stage ('GIT VERSION - registerEnvVariables') {
            steps {
                script {
                    gitversion.registerEnvVariables(".", "./.gitversion")
                    env.GITVERSION_REGISTERED = sh(returnStdout: true, script: "date -u +'%Y-%m-%dT%H:%M:%SZ'").trim()
                }
                buildName "${env.FullSemVer}"
            }
        }
        stage ('Test pytest') {
            steps {
                sh '''
                    docker build -t lcli .
                '''
            }
        }
        stage ('Other stage') {
            agent {
                docker {
                    image "${env.DOCKER_AGENT_PYTHON_IMAGE}"
                }
            }
            steps {
                sh '''
                    python --version
                '''
            }
        }
    }
}