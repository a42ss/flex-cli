@Library('a42-jenkins-general-library') _

pipeline {
    environment {
        DOCKER_AGENT_PYTHON_IMAGE="python:3.10-alpine"
    }

    agent  any

    stages {
        stage ('GIT VERSION - registerEnvVariables') {
            steps {
                script {
                    gitversion.registerEnvVariables(".", "./.gitversion")
                    env.GITVERSION_REGISTERED = sh(returnStdout: true, script: "date -u +'%Y-%m-%dT%H:%M:%SZ'").trim()
                }
                buildName "${env.FullSemVer}"
            }
        }
        stage ('Test pytest') {
            agent {
                docker {
                    image "${env.DOCKER_AGENT_PYTHON_IMAGE}"
                    args "${env.DOCKER_AGENT_PYTHON_OPTIONS}"
                }
            }
            steps {
                sh '''
                    pytest
                '''
            }
        }
    }
}